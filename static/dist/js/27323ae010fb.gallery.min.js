this.Handlebars=this.Handlebars||{},this.Handlebars.gallery_inline=Handlebars.template(function(Handlebars,a,b,c,d){function e(a,c){var d,e,g,h="";return h+='\n      <li class="sly-slide header-gallery-overlay" style="width: ',g={hash:{},inverse:i.noop,fn:i.program(2,f,c),data:c},(e=b.getWidth)?d=e.call(a,g):(e=a&&a.getWidth,d=typeof e===j?e.call(a,g):e),b.getWidth||(d=k.call(a,d,{hash:{},inverse:i.noop,fn:i.program(2,f,c),data:c})),(d||0===d)&&(h+=d),h+='px;">\n        ',e=b.loader||a&&a.loader,g={hash:{},inverse:i.noop,fn:i.program(2,f,c),data:c},d=e?e.call(a,null==c||c===!1?c:c.index,g):l.call(a,"loader",null==c||c===!1?c:c.index,g),(d||0===d)&&(h+=d),h+='\n        <div class="m-wrap m-transparent"><img class="m-bg" data-img-src="',(e=b.src)?d=e.call(a,{hash:{},data:c}):(e=a&&a.src,d=typeof e===j?e.call(a,{hash:{},data:c}):e),h+=m(d)+'"></div>\n        <div class="blanket"></div>\n      </li>\n    '}function f(a,b){var c="";return c}this.compilerInfo=[4,">= 1.0.0"],b=this.merge(b,Handlebars.helpers),d=d||{};var g,h="",i=this,j="function",k=b.blockHelperMissing,l=b.helperMissing,m=this.escapeExpression;return h+='<div id="inline-gallery-frame" class="header-feature-bg header-gallery-frame frame" >\n  <ul class="slidee">\n    ',g=b.each.call(a,a&&a.inline,{hash:{},inverse:i.noop,fn:i.program(1,e,d),data:d}),(g||0===g)&&(h+=g),h+="\n  </ul>\n</div>"}),this.Handlebars.gallery_modal=Handlebars.template(function(Handlebars,a,b,c,d){function e(a,c){var d,e,f="";return f+='\n<div class="sly-slide" data-closeable="0">\n  <img class="m-wrap m-transparent" data-img-src="',(e=b.src)?d=e.call(a,{hash:{},data:c}):(e=a&&a.src,d=typeof e===g?e.call(a,{hash:{},data:c}):e),f+=h(d)+'">\n  <span class="rsCaption">',(e=b.caption)?d=e.call(a,{hash:{},data:c}):(e=a&&a.caption,d=typeof e===g?e.call(a,{hash:{},data:c}):e),f+=h(d)+'</span>\n  <div class="loader-icon"><i class="icon-reload"></i></div>\n</div>\n'}this.compilerInfo=[4,">= 1.0.0"],b=this.merge(b,Handlebars.helpers),d=d||{};var f,g="function",h=this.escapeExpression,i=this;return f=b.each.call(a,a&&a.inline,{hash:{},inverse:i.noop,fn:i.program(1,e,d),data:d}),f||0===f?f:""}),this.Handlebars.gallery_thumb=Handlebars.template(function(Handlebars,a,b,c,d){function e(a,c){var d,e,f="";return f+='\n<li><img src="',(e=b.src)?d=e.call(a,{hash:{},data:c}):(e=a&&a.src,d=typeof e===g?e.call(a,{hash:{},data:c}):e),f+=h(d)+'" width="150" height="150"></li>\n'}this.compilerInfo=[4,">= 1.0.0"],b=this.merge(b,Handlebars.helpers),d=d||{};var f,g="function",h=this.escapeExpression,i=this;return f=b.each.call(a,a&&a.thumbnails,{hash:{},inverse:i.noop,fn:i.program(1,e,d),data:d}),f||0===f?f:""}),function(a,b){"use strict";function c(a){$(a.elements[0]).closest("div").removeClass("m-transparent").prev().remove()}function d(a,b){var c=this,e={batch:10,position:0,length:0};b=b||{};for(var f in d.defaults)b.hasOwnProperty(f)||(b[f]=d.defaults[f]);return e.length=a.length,c.load=function(c){if(c===e.position){var d=e.position,f=d+e.batch;f>e.length&&(f=e.length);for(var g=d;f>g;g++){var h=$(a[g]);h.attr("src",h.data("img-src")),imagesLoaded(h,b.onLoad)}e.position+=e.batch}},c}d.defaults={onLoad:c},a.LazyImage=d}(window);var Views=window.Namespace("Views");Views.Gallery=function(){function a(){LWA.Modules.Util.delay(function(){g.reload(),f.reload(),e.reload()},200)}var b={isRight:function(a,b){return b>a}},c=function(a,b){var c=this,d="gallery-home-active";c.show=function(){a.addClass(d)},c.hide=function(){a.removeClass(d)},a.click(function(){b.call(c)})},d=function(a){var b=this,c="gallery-next-active";b.show=function(){a.addClass(c)},b.hide=function(){a.removeClass(c)},b.isActive=function(){return a.hasClass(c)}},e={state:{modal:void 0,slider:void 0,responsive:{height:120,heightTouch:160},startTime:0,prevPos:0,isActive:!1},template:Handlebars.gallery_modal,NextUp:{state:{pos:0},isFirst:function(){return 0===this.state.slider.currSlideId},isEnabled:function(){return this.elements.slider.hasClass("gallery-next-enable")},isActivated:function(){return this.elements.slider.hasClass("gallery-next-active")},activate:function(){this.elements.slider.addClass("gallery-next-active"),e.elements.$next.hide()},deactivate:function(){this.elements.slider.removeClass("gallery-next-active"),e.elements.$next.show()},enable:function(){this.elements.slider.addClass("gallery-next-enable")},disable:function(){this.elements.slider.removeClass("gallery-next-enable")},onActivate:function(a){var b=this.state.slider.currSlideId;this.isFirst()?this.deactivate():this.activate(),this.isFirst()&&b===this.state.pos&&(this.disable(),e.prev()),this.state.pos=b},destroy:function(){this.state.slider.goTo(0),this.disable(),this.deactivate(),e.state.slider.goTo(0),e.onActivate(0)},init:function(){this.elements={slider:$("#modal-slider-next")};var a=this.elements.slider.find(".royalSlider");this.state.slider=a.css({width:LWA.Modules.Util.windowWidth(),height:LWA.Modules.Util.windowHeight()}).royalSlider({sliderDrag:!1,navigateByClick:!1,transitionSpeed:260,startSlideId:0,controlNavigation:"none",fadeinLoadedSlide:!1,addActiveClass:!0,arrowsNav:!1}).data("royalSlider"),this.state.slider.ev.on("rsBeforeAnimStart",function(a){e.NextUp.onActivate(a)}),a.find("#modal-gallery-home").click(function(){e.NextUp.destroy()})}},init:function(){e.state.startTime=(new Date).getTime(),e.state.isActive=!0,void 0===e.state.slider&&(e.elements={$slider:$("#modal-gallery-frame .royalSlider"),$total:e.state.modal.el().find(".modal-gallery-count"),$next:e.state.modal.el().find(".sly-next")},e.state.modal.el().find(".sly-prev").click(e.prev),e.state.modal.el().find(".sly-next").click(e.next),e.elements.$slider.html(e.template(LWA.Data.Gallery)),LWA.hasNextPost&&e.NextUp.init(),e.state.startAgain=new c($("#modal-gallery-home"),e.startAgain),e.state.lazyImage=new LazyImage(e.elements.$slider.find("img"),{onLoad:function(a){$(a.elements[0]).removeClass("m-transparent").next().remove()}}),e.state.lazyImage.load(0),e.buildSlider(0),e.initKeyboardNav())},initKeyboardNav:function(){$(document).keydown(function(a){e.state.isActive===!0&&(37===a.which?e.prev():39===a.which&&e.next())})},buildSlider:function(a){e.state.slider=e.elements.$slider.royalSlider({arrowsNav:!1,sliderDrag:!1,navigateByClick:!1,fadeinLoadedSlide:!1,controlNavigation:"none",globalCaption:!0,addActiveClass:!0,startSlideId:a,transitionSpeed:260}).data("royalSlider"),e.state.slider.ev.on("rsAfterSlideChange",function(a){ga("send","event","Gallery","click","Gallery modal navigate",{page:location.pathName}),e.onActivate(e.state.slider.currSlideId)}),e.onActivate(a),e.setFrameHeight()},startAgain:function(){LWA.hasNextPost&&e.NextUp.isEnabled()?e.NextUp.destroy():e.state.slider.goTo(0)},destroy:function(){e.startAgain(),e.state.isActive=!1;var a=(new Date).getTime();ga("send","timing","Gallery","Modal view",a-e.state.startTime,"Gallery modal",{page:location.pathName})},next:function(){return LWA.hasNextPost&&e.NextUp.isEnabled()?(e.NextUp.activate(),e.NextUp.state.slider.goTo(1),void e.state.startAgain.show()):void e.state.slider.next()},prev:function(){return LWA.hasNextPost&&e.NextUp.isActivated()?(e.NextUp.deactivate(),e.NextUp.state.slider.goTo(0),void e.state.startAgain.hide()):(LWA.hasNextPost&&e.NextUp.disable(),void e.state.slider.prev())},onActivate:function(a){this.state.lazyImage.load(a),a+=1,this.elements.$total.html(a+" / "+this.state.slider.numSlides),1===a||b.isRight(this.state.prevPos,a)?this.state.startAgain.hide():this.state.startAgain.show(),LWA.hasNextPost&&a===this.state.slider.numSlides&&this.NextUp.enable(),this.state.prevPos=a},setFrameHeight:function(){var a=LWA.Modules.Util.getResponsive().BP1.match()?e.state.responsive.heightTouch:e.state.responsive.height;e.elements.$slider.css("height",LWA.Modules.Util.windowHeight()-a),e.elements.$slider.find(".rsOverflow").css("height",LWA.Modules.Util.windowHeight()-a)},reload:function(){void 0!==e.state.slider&&(e.state.modal.loader.start(),e.elements.$slider.css("width",""),e.elements.$slider.find(".rsOverflow").css("width",""),e.state.slider.updateSliderSize(!0),e.setFrameHeight(),setTimeout(function(){e.state.modal.loader.stop()},1e3))}},f={state:{sly:void 0,initialised:!1,template:Handlebars.gallery_thumb},elements:{$header:$(".header")},toggle:function(){f.initialised||(f.initialised=!0,f.render(),f.state.sly.init(),f.state.sly.on("active",f.onActivate)),f.elements.$header.toggleClass("header-gallery-thumbs-active")},init:function(){f.initialiseSly($("#header-gallery-thumbs")),$("#gallery-thumbs").click(f.toggle)},initialiseSly:function(a){f.state.sly=new Sly("#header-gallery-thumbs",{horizontal:1,itemNav:"basic",smart:1,activateOn:"click",mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:0,speed:300,elasticBounds:1,easing:"swing",prevPage:a.find(".sly-prev"),nextPage:a.find(".sly-next")})},onActivate:function(a,b){g.setActive(b)},setActive:function(a){f.state.sly.activate(a)},reload:function(){f.state.sly.reload()},render:function(){var a=$(f.state.template({thumbnails:LWA.Data.Gallery.thumbnails}));f.state.sly.add(a)}},g={element:{title:$(".header-gallery-title"),overlay:$("#header-gallery .m-overlay"),gallery:$("#header-gallery-wrap")},state:{sly:void 0,responsive:void 0,isTouch:!1,loader:!1,previousPosition:0},template:Handlebars.gallery_inline,init:function(){this.state.responsive=LWA.Modules.Util.getResponsive(),this.state.isTouch=!this.state.responsive.BP3.match(),this.state.loader=LWA.Modules.Spinner("#header-gallery .loader-icon",{show:!0}),this.element.title.on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",g.onTransitionEnd),Handlebars.registerHelper("getWidth",function(){return Math.round(this.width*(748/this.height))}),Handlebars.registerHelper("loader",function(a){return a>1?'<div class="loader-icon"><i class="icon-reload"></i></div>':void 0});var a=$("#inline-gallery-controls");a.find(".sly-prev").click(g.prev),a.find(".sly-next").click(g.next),this.state.finalSlide=new d(g.element.gallery),this.state.startAgain=new c($("#inline-gallery-home"),this.reset),this.chooseRendering(this.state.loader),this.state.isTouch===!1&&this.initKeyboardNav()},initKeyboardNav:function(){$(document).keydown(function(a){e.state.isActive===!1&&(37===a.which?g.prev():39===a.which&&g.next())})},initialiseSlider:function(){g.state.sly=new Sly("#inline-gallery-frame",{horizontal:1,itemNav:"centered",smart:1,activateOn:"click",touchDragging:0,releaseSwing:1,startAt:0,speed:300,elasticBounds:1,easing:"swing"}),g.state.sly.init(),g.state.sly.on("active",g.onActivate)},chooseRendering:function(a){this.state.responsive.BP3.match()&&this.state.isTouch!==!0?(this.renderFeature(),LWA.Modules.Loader({imageContent:"#tmpl-gallery-images",hiddenContent:"#header-gallery .m-wrap",loader:a}),this.state.isTouch=!0):this.state.responsive.BP3.match()||this.state.isTouch!==!0||(g.renderGallery(),setTimeout(function(){$("#header-gallery-wrap").removeClass("m-transparent"),g.state.loader.destroy()},2e3),this.state.isTouch=!1)},renderGallery:function(){g.element.overlay.hide();var a=$("#tmpl-gallery-images").html(this.template(LWA.Data.Gallery));g.state.lazyImage=new LazyImage(a.find("img")),g.state.lazyImage.load(0),g.initialiseSlider()},renderFeature:function(){$("#tmpl-gallery-images").css("background-image","url("+LWA.Data.Gallery.feature+")").addClass("header-feature-bg"),g.element.overlay.show(),g.showTitle()},destroyFeature:function(){$("#tmpl-gallery-images").css("background-image","none").removeClass("header-feature-bg")},destroyGallery:function(){$("#tmpl-gallery-images").html(""),g.state.sly.destroy()},onActivate:function(a,b){ga("send","event","Gallery","click","Gallery inline navigate",{page:location.pathName}),f.setActive(b),g.state.previousPosition>b?g.state.startAgain.show():g.state.startAgain.hide(),b>0?g.hideTitle():(g.showTitle(),g.element.gallery.removeClass("gallery-end"),g.state.startAgain.hide()),g.isEnd()&&g.element.gallery.addClass("gallery-end"),g.state.lazyImage.load(b),g.state.previousPosition=b},next:function(){return LWA.hasNextPost&&g.isEnd()?(g.state.finalSlide.show(),void g.state.startAgain.show()):void g.state.sly.next()},prev:function(){return g.state.finalSlide.isActive()?(g.state.finalSlide.hide(),void g.state.startAgain.hide()):(g.state.sly.prev(),void g.element.gallery.removeClass("gallery-end"))},isEnd:function(){return this.state.sly.items.length-1===this.state.sly.rel.activeItem},showTitle:function(){g.element.title.css("display",""),setTimeout(function(){g.element.gallery.removeClass("animate-gallery")},200)},hideTitle:function(){g.element.gallery.addClass("animate-gallery")},onTransitionEnd:function(a){g.element.gallery.hasClass("animate-gallery")&&g.element.title.css("display","none")},setActive:function(a){g.state.sly.activate(a)},reset:function(){g.state.sly.activate(0),g.state.finalSlide.hide()},reload:function(){this.state.responsive.BP3.match()&&this.state.isTouch!==!0?(this.destroyGallery(),this.renderFeature(),this.state.isTouch=!0):this.state.responsive.BP3.match()||this.state.isTouch!==!0?this.state.isTouch===!1&&this.state.sly.reload():(this.destroyFeature(),this.renderGallery(),this.state.isTouch=!1)}};return{init:function(){f.init(),g.init(),e.state.modal=LWA.Modules.Modal("#modal-gallery-button","#modal-gallery",{closeable:!0,open:e.init,close:e.destroy}),$(window).resize(a)}}}(),LWA.Views.Gallery.init();
//# sourceMappingURL=gallery.min.js.map